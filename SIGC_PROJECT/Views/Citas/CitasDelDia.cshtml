@model SIGC_PROJECT.Models.ViewModel.CitasDelDiaVM

@{
    ViewData["Title"] = "Citas Agendas";
}

<div class="container" style="margin-top: 5em;">
    <h2 class="mb-4 ml-2" style="font-weight: bold; font-size: 2.2em; color: #04294F;">Citas del día</h2>

    @if (!Model.Citas.Any())
    {
        <div class="alert alert-info text-center">
            <h2 style="font-weight: bold;">No hay citas agendadas para este día.</h2>
        </div>

        <div>
            <a asp-action="CalendarioCitas" asp-controller="Citas" class="btn btn-estilo">Ir al calendario</a>
        </div>
    }
    else
    {
        foreach (var cita in Model.Citas)
        {
            <div class="col-md-5">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title text-center" style="font-weight: bold; color: #04294F;">@cita.NombreDoctor</h5>
                        <h6 class="card-title mb-2 text-center" style="font-weight: bold; color: #000000;">@cita.EspecialidadDoctor</h6>
                        <div class="mb-3" style="border-bottom: 1px solid #04294F;"></div>
                        <p class="card-text">
                            <strong>Paciente: </strong> @cita.NombrePaciente
                        </p>
                        <p class="card-text">
                            <strong>Fecha: </strong> @(cita.FechaCita.HasValue ? cita.FechaCita.Value.ToString("dd/MM/yyyy") : "No disponible")
                        </p>
                        <p class="card-text">
                            <strong>Hora: </strong> @cita.HoraCita
                        </p>
                        <p class="card-text">
                            <strong>Estado: </strong> @cita.Estado
                        </p>
                        <p class="card-text">
                            <strong>Motivo de la cita: </strong> @cita.Comentario
                        </p>
                    </div>
                    <div class="card-footer text-center">
                        <button type="button" class="btn btn-danger font-weight-bold" data-cita-id="@cita.CitaId">
                            Cancelar Cita
                        </button>

                        <button type="button" class="btn btn-primary font-weight-bold" data-cita-idc="@cita.CitaId">
                            Completar Cita
                        </button>
                    </div>
                </div>
            </div>
        }
    }
</div>

<!-- Modal de Confirmación de Cancelación -->
<div class="modal fade" id="confirmCancel" tabindex="-1" aria-labelledby="confirmCancelModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header justify-content-center">
                <h5 class="modal-title font-weight-bold" id="confirmCancelModalLabel" style="color: #000000;">Confirmar Cancelación</h5>
            </div>
            <div class="modal-body text-center">
                <h6 style="color: #000000; font-weight: bold;">
                    ¿Está seguro de que desea cancelar esta cita?
                </h6>
            </div>
            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary font-weight-bold" id="modalCerrar" style="width: 20%;">No</button>
                <a id="btnConfirmCancel" class="btn btn-primary font-weight-bold" href="#" style="width: 20%;">Sí</a>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Confirmación de Completado -->
<div class="modal fade" id="confirmComplete" tabindex="-1" aria-labelledby="confirmCompleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header justify-content-center">
                <h5 class="modal-title font-weight-bold" id="confirmCancelModalLabel" style="color: #000000;" id="confirmCompleteModalLabel">Confirmar Completar Cita</h5>
            </div>
            <div class="modal-body text-center">
                <h6 style="color: #000000; font-weight: bold;">
                    ¿Está seguro de que desea completar esta cita?
                </h6>
            </div>

            <div class="modal-footer justify-content-center">
                <button type="button" class="btn btn-secondary font-weight-bold" id="modalCerrarC" style="width: 20%;">No</button>
                <a id="btnconfirmComplete" class="btn btn-primary font-weight-bold" href="#" style="width: 20%;">Sí</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    @*====== FUNCIONALIDADES ======*@
    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // Cancelar Cita
            var cancelButtons = document.querySelectorAll('[data-cita-id]');
            var confirmCancelButton = document.getElementById('btnConfirmCancel');

            cancelButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    $('#confirmCancel').modal('show');

                    var citaId = this.getAttribute('data-cita-id');
                    confirmCancelButton.href = '@Url.Action("CancelarCita")' + '?id=' + citaId;
                });
            });

            document.getElementById('modalCerrar').addEventListener('click', function () {
                $('#confirmCancel').modal('hide');
            });

            // Completar Cita
            var completeButtons = document.querySelectorAll('[data-cita-idc]');
            var confirmCompleteButton = document.getElementById('btnconfirmComplete');

            completeButtons.forEach(function (button) {
                button.addEventListener('click', function () {
                    $('#confirmComplete').modal('show');

                    var citaId = this.getAttribute('data-cita-idc');
                    confirmCompleteButton.href = '@Url.Action("CompletarCita")' + '?id=' + citaId;
                });
            });

            document.getElementById('modalCerrarC').addEventListener('click', function () {
                $('#confirmComplete').modal('hide');
            });
        });
    </script>
    @*=============================*@

    @*====== ESTILOS ======*@
    <style>
        .card-text {
            color: #000000;
            font-size: 1.2em;
        }

        .btn-estilo {
            background-color: rgba(42, 62, 84, 1);
            color: #FFFFFF;
            font-weight: bold;
            transition: background-color 0.5s linear;
        }

        .btn-estilo:hover {
            background-color: rgba(42, 62, 84, 0.8);
            color: #FFFFFF;
        }

    </style>
    @*=====================*@
}