@model IPagedList<SIGC_PROJECT.Models.Doctor>

@using X.PagedList;
@using X.PagedList.Mvc.Core;

@{
    ViewData["Title"] = "Registro de Doctores";
}
<div style="margin-top: 7%;"></div>

<h2 style="font-weight: bold; font-size: 1.7em; color: #04294F;" class="mt-5 mb-5">Listado de Doctores</h2>

<div class="row mt-4 mb-4">

    <div class="col-md-4 d-flex align-items-center">
        <a asp-action="Create" class="btn btn-estilo">Agregar Registro</a>
    </div>

    <div class="col-md-8 d-flex justify-content-end align-items-center">
        <label for="buscarEspecialidad" class="control-label me-2 mb-0 mr-1" style="font-weight: bold; color: #04294F;">Buscar por Especialidad:</label>
        <select id="buscarEspecialidad" class="form-control w-auto">
            <option value="" selected>Seleccionar...</option>
            <option value="Anestesiología">Anestesiología</option>
            <option value="Cardiología">Cardiología</option>
            <option value="Cirugía Bariátrica">Cirugía Bariátrica</option>
            <option value="Cirugía General">Cirugía General</option>
            <option value="Cirugía Maxilofacial">Cirugía Maxilofacial</option>
            <option value="Cirugía Pediátrica">Cirugía Pediátrica</option>
            <option value="Cirugía Plástica, Reconstructiva y Estética">Cirugía Plástica, Reconstructiva y Estética</option>
            <option value="Dermatología y Cirugía de la Piel">Dermatología y Cirugía de la Piel</option>
            <option value="Diabetología">Diabetología</option>
            <option value="Endocrinología">Endocrinología</option>
            <option value="Epidemiología">Epidemiología</option>
            <option value="Gastroenterología">Gastroenterología</option>
            <option value="Ginecología y Obstetricia">Ginecología y Obstetricia</option>
            <option value="Hematología">Hematología</option>
            <option value="Infectología">Infectología</option>
            <option value="Intensivistas Pediatricos y de Adultos">Intensivistas Pediatricos y de Adultos</option>
            <option value="Medicina General">Medicina General</option>
            <option value="Medicina Interna">Medicina Interna</option>
            <option value="Nefrología">Nefrología</option>
            <option value="Neumología">Neumología</option>
            <option value="Neumología pediátrica">Neumología pediátrica</option>
            <option value="Neurocirugía">Neurocirugía</option>
            <option value="Neurología">Neurología</option>
            <option value="Oftalmología">Oftalmología</option>
            <option value="Ortopedia y Traumatología">Ortopedia y Traumatología</option>
            <option value="Otorrinolaringología">Otorrinolaringología</option>
            <option value="Pediatría">Pediatría</option>
            <option value="Radiología y Sonografía">Radiología y Sonografía</option>
            <option value="Urología">Urología</option>
        </select>
        @* <input type="text" id="buscarEspecialidad" class="form-control w-auto" /> *@
    </div>
</div>

<table class="table table-striped">
    <thead>
        <tr class="th_bg">
            <th>Cédula</th>
            <th>Nombre Completo</th>
            <th>@Html.DisplayNameFor(model => model.First().Especialidad)</th>
            <th>No. Exequatur</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
@foreach (var item in Model) {
        <tr>
            <td>
                @Html.DisplayFor(modelItem => item.Cedula)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Nombre) @Html.DisplayFor(modelItem => item.Apellido)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Especialidad)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.NumeroExequatur)
            </td>
            <td class="text-center">
                    <a asp-action="Edit" data-toggle="tooltip" title="Editar" class=" btn btn-warning" asp-route-id="@item.DoctorId"><i class="fa fa-edit"></i></a>
                    <a asp-action="Details" data-toggle="tooltip" title="Detalles" class=" btn btn-primary" asp-route-id="@item.DoctorId"><i class="fa fa-info-circle"></i></a>
                    <a asp-action="Delete" data-toggle="tooltip" title="Eliminar" class=" btn btn-danger" asp-route-id="@item.DoctorId"><i class="fa fa-trash"></i></a>
            </td>
        </tr>
}
    </tbody>
</table>

<div class="contenedor-paginacion">
    @Html.PagedListPager(Model, pagina => Url.Action("Index", new { pagina = pagina, especialidad = ViewBag.Especialidad }), new PagedListRenderOptions
    {    
        DisplayPageCountAndCurrentLocation = false,
        DisplayLinkToFirstPage = PagedListDisplayMode.Always,
        DisplayLinkToLastPage = PagedListDisplayMode.Always,
        DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
        DisplayLinkToNextPage = PagedListDisplayMode.Always,
        DisplayLinkToIndividualPages = true,
        MaximumPageNumbersToDisplay = 10,
        DisplayEllipsesWhenNotShowingAllPageNumbers = true,
        Display = PagedListDisplayMode.Always,

        UlElementClasses = new [] { "pagination", "justify-content-center" },
        LiElementClasses = new [] { "page-item" },
        PageClasses = new [] {"page-link" }
    })

    <div class="paginacion_dabajo">
        @string.Format("Página {0} de {1}", Model.PageNumber, Model.PageCount)
    </div>
</div>

@section Scripts {

    @*========== FUNCIONES ==========*@
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var searchInput = document.getElementById('buscarEspecialidad');

            searchInput.addEventListener("input", function () {
                var valor = searchInput.value;

                var searchParams = new URLSearchParams(window.location.search);
                searchParams.set('especialidad', valor);
                searchParams.set('pagina', 1); // Resetear a la primera página

                //Enviar Solicitud Ajax al controlador
                fetch(window.location.pathname + '?' + searchParams.toString())
                    .then(response => response.text())
                    .then(html => {
                        var parser = new DOMParser();
                        var doc = parser.parseFromString(html, 'text/html');
                        var nuevaTabla = doc.querySelector('tbody').innerHTML;
                        document.querySelector('tbody').innerHTML = nuevaTabla;
                        var newPagination = doc.querySelector('.contenedor-paginacion').innerHTML;
                        document.querySelector('.contenedor-paginacion').innerHTML = newPagination;
                    })
                    .catch(error => console.error('Error al buscar pacientes:', error));
            });
        });
    </script>

    <!-- Agregar estilos CSS -->
    <style>
        .paginacion_dabajo {
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
        }

        .contenedor-paginacion {
            text-align: center;
        }

        .active.page-item .page-link { 
            background-color: rgba(42, 62, 84, 1) !important;
            font-weight: bold;
            border: 2px solid rgba(42, 62, 84, 1) !important;
        }

        .th_bg {
            background-color: rgba(42, 62, 84, 1);
            color: #FFFFFF;
        }

        th { 
            border: 1px solid #FFFFFF;
        }

        .btn-estilo {
            background-color: rgba(42, 62, 84, 1);
            color: #FFFFFF;
            transition: background-color 0.5s linear;
            width: 50%;
            font-weight: bold;
            font-size: 1.1em;
        }

        .btn-estilo:hover {
            background-color: #062043;
            color: #FFFFFF;
        }
    </style>
}
